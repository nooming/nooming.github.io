const LANG=document.documentElement.lang||"en",WheelPresetManager=(()=>{let e,t;"en"===LANG?(e="base_QexnBBQ3_AllPresets",t="base_QexnBBQ3_ActivePresetId"):"zh"===LANG?(e="base_UbHWwvP2_AllPresets",t="base_UbHWwvP2_ActivePresetId"):"es"===LANG&&(e="base_MrQ8yG1z_AllPresets",t="base_MrQ8yG1z_ActivePresetId");const o="entries",r="close";let n;function l(){return crypto.randomUUID()}function i(){const t=localStorage.getItem(e);return t?JSON.parse(t):[]}function a(t){localStorage.setItem(e,JSON.stringify(t))}function s(e){return e&&"string"==typeof e.name&&Array.isArray(e.prizes)&&e.prizes.every(e=>"string"==typeof e.text)}function d(){localStorage.getItem(e)||(a(n),u(n[0].id))}function c(e){return i().find(t=>t.id===e)||null}function f(e){if(!s(e)){if("en"===LANG)throw new Error("Invalid preset format");if("zh"===LANG)throw new Error("预设格式无效");if("es"===LANG)throw new Error("El formato del preajuste no es válido")}const t=i();if(t.some(t=>t.name===e.name)){if("en"===LANG)throw new Error(`A preset named "${e.name}" already exists`);if("zh"===LANG)throw new Error(`名为 “${e.name}” 的预设已存在`);if("es"===LANG)throw new Error(`Ya tienes un preajuste llamado "${e.name}"`)}return e.id=e.id||l(),"en"===LANG?e.name=e.name||"Untitled":"zh"===LANG?e.name=e.name||"未命名":"es"===LANG&&(e.name=e.name||"Sin título"),e.isDefault=e.isDefault||!1,e.prizes=e.prizes||[],e.mode=e.mode||o,e.advancedMode=e.advancedMode||r,e.lastUsedAt=e.lastUsedAt||Date.now(),t.push(e),a(t),e.id}function u(e){localStorage.setItem(t,e)}function m(){return localStorage.getItem(t)}function p(e){c(e)&&u(e)}return"en"===LANG?n=[{id:"default",name:"Default",isDefault:!0,prizes:[{id:l(),text:"Choice 1",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Choice 2",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Choice 3",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Choice 4",bgColor:"#e67c92",textColor:"#ffffff"},{id:l(),text:"Choice 5",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Choice 6",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Choice 7",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Choice 8",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"yes-or-no",name:"Yes or No",isDefault:!1,prizes:[{id:l(),text:"Yes",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"No",bgColor:"#bddb69",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"what-to-eat",name:"What to Eat",isDefault:!1,prizes:[{id:l(),text:"Pizza",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Burger",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Steak",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Salad",bgColor:"#e67c92",textColor:"#ffffff"},{id:l(),text:"Tacos",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Fried Chicken",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Pasta",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Sandwich",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()}]:"zh"===LANG?n=[{id:"default",name:"默认",isDefault:!0,prizes:[{id:l(),text:"选择 1",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"选择 2",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"选择 3",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"选择 4",bgColor:"#e67c92",textColor:"#ffffff"},{id:l(),text:"选择 5",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"选择 6",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"选择 7",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"选择 8",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"yes-or-no",name:"是或否",isDefault:!1,prizes:[{id:l(),text:"是",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"否",bgColor:"#bddb69",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"rock-or-paper-or-scissors",name:"剪刀石头布",isDefault:!1,prizes:[{id:l(),text:"剪刀",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"石头",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"布",bgColor:"#c386f0",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()}]:"es"===LANG&&(n=[{id:"default",name:"Por defecto",isDefault:!0,prizes:[{id:l(),text:"Opción 1",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Opción 2",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Opción 3",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Opción 4",bgColor:"#e67c92",textColor:"#ffffff"},{id:l(),text:"Opción 5",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Opción 6",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Opción 7",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Opción 8",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"weekend-plans",name:"Planes de fin de semana",isDefault:!1,prizes:[{id:l(),text:"Salir de fiesta",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Netflix y sofá",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Excursión",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Ir de tapas",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()},{id:"party-games",name:"Juegos de fiesta",isDefault:!1,prizes:[{id:l(),text:"Verdad o reto",bgColor:"#92c48d",textColor:"#ffffff"},{id:l(),text:"Chupito",bgColor:"#bddb69",textColor:"#ffffff"},{id:l(),text:"Cantar en karaoke",bgColor:"#c386f0",textColor:"#ffffff"},{id:l(),text:"Bailar reguetón",bgColor:"#e67c92",textColor:"#ffffff"}],mode:o,advancedMode:r,lastUsedAt:Date.now()}]),{init:d,getAll:function(){return i()},get:c,add:f,remove:function(e){const t=i().filter(t=>t.id!==e||t.isDefault);if(a(t),m()===e){const e=t[0];e?p(e.id):d()}},update:function(e,t){a(i().map(o=>o.id===e?{...o,...t}:o))},clone:function(e){const t=c(e);if(!t)return null;let o;return"en"===LANG?o=" - copy":"zh"===LANG?o=" - 副本":"es"===LANG&&(o=" - copia"),f({...t,id:l(),isDefault:!1,name:t.name+o,lastUsedAt:Date.now()})},setActive:u,getActiveId:m,getActive:function(){return c(m())||i()[0]},apply:p,exportAll:function(){return JSON.stringify(i(),null,2)},importAll:function(e){try{const t=JSON.parse(e);if("en"===LANG){if(!Array.isArray(t))throw new Error("Invalid format")}else if("zh"===LANG){if(!Array.isArray(t))throw new Error("格式无效")}else if("es"===LANG&&!Array.isArray(t))throw new Error("Formato no válido");const o=t.filter(s);a(o),o.length>0&&(u(o[0].id),p(o[0].id))}catch(e){"en"===LANG?console.error("Import failed ",e.message):"zh"===LANG?console.error("导入失败 ",e.message):"es"===LANG&&console.error("Error al importar ",e.message)}}}})();WheelPresetManager.init();let wheelSpin,MY_WHEEL_WIDTH="480px",MY_WHEEL_HEIGHT="480px";"en"===LANG?wheelSpin="SPIN":"zh"===LANG?wheelSpin="开始":"es"===LANG&&(wheelSpin="Girar");const myWheel=new LuckyCanvas.LuckyWheel("#my-wheel",{width:MY_WHEEL_WIDTH,height:MY_WHEEL_HEIGHT,blocks:[{padding:"10px",background:"#ffffff"}],prizes:transformPresetPrizesToLuckyWheel(WheelPresetManager.getActive().prizes),defaultConfig:{stopRange:.8,speed:10,gutter:"0px",accelerationTime:1e3,decelerationTime:3e3,offsetDegree:0},buttons:[{radius:"25%",background:"#f8f8f8"},{radius:"20%",background:"#f2994a",pointer:!0,fonts:[{text:wheelSpin,fontColor:"#ffffff",top:"-10px"}]}],start:function(){myWheelElement.classList.remove("my-wheel-box-shake"),document.querySelector(".wheel-scope-right-box")?.classList.add("disabled"),myWheel.play();const e=WheelPresetManager.getActive()?.prizes||[];currentWinIndex=Math.floor(Math.random()*e.length),setTimeout(()=>{myWheel.stop(currentWinIndex)},3e3)},end(){document.querySelector(".wheel-scope-right-box")?.classList.remove("disabled");const e=WheelPresetManager.getActive()?.prizes||[];let t;"en"===LANG?t=e[currentWinIndex]?.text||"Unknown prize":"zh"===LANG?t=e[currentWinIndex]?.text||"未知奖品":"es"===LANG&&(t=e[currentWinIndex]?.text||"Premio desconocido");let o=prizeResultElement.value.trim();o+=(o.length>0?"\n":"")+t,prizeResultElement.value=o,prizeResultElement.scrollTop=prizeResultElement.scrollHeight,showLuckyModal(`${t}`),savePrizeHistory(o),canvasConfettiFireworks(),playClickSound()}});function transformPresetPrizesToLuckyWheel(e){return e.map(e=>{const t={text:e.text||"",fontColor:e.textColor||"#ffffff",top:"10%"};return e.format?.lengthLimit&&(t.lengthLimit=e.format.lengthLimit),e.format?.lineClamp&&(t.lineClamp=e.format.lineClamp),{background:e.bgColor||"#35b682",fonts:[t]}})}function transformLuckyWheelPrizesToPreset(e){return e.map(e=>({id:crypto.randomUUID(),text:e.fonts?.[0]?.text||"",bgColor:e.background||"#ffffff",textColor:e.fonts?.[0]?.fontColor||"#000000"}))}function canvasConfettiFireworks(){let e=Date.now()+5e3,t={startVelocity:30,spread:360,ticks:60,zIndex:9999};function o(e,t){return Math.random()*(t-e)+e}let r=setInterval(function(){let n=e-Date.now();if(n<=0)return clearInterval(r);let l=n/5e3*50;confetti({...t,particleCount:l,origin:{x:o(.1,.3),y:Math.random()-.2}}),confetti({...t,particleCount:l,origin:{x:o(.7,.9),y:Math.random()-.2}})},250)}function playClickSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),o=e.createGain();t.type="sine",t.frequency.setValueAtTime(880,e.currentTime),o.gain.setValueAtTime(.2,e.currentTime),o.gain.exponentialRampToValueAtTime(.001,e.currentTime+.6),t.connect(o),o.connect(e.destination),t.start(),t.stop(e.currentTime+.6)}const myWheelElement=document.getElementById("my-wheel");myWheelElement.classList.add("my-wheel-box-shake");const wheelScopeCenterBoxElement=document.querySelector(".wheel-scope-center-box");wheelScopeCenterBoxElement.classList.add("wheel-scope-center-box-shake");let currentWinIndex=null;const prizeInputElement=document.getElementById("prize-input"),prizeResultElement=document.getElementById("prize-result"),itemContainerElement=document.getElementById("item-container"),itemContainerAddSelector=document.querySelector(".wheel-panel-entries-advanced-text-add-add-inner-box"),itemPresetContainerAddSelector=document.querySelector(".wheel-preset-text-add-add-inner-box"),BASE_JSCOLOR_DEFAULT_COLORS={BACKGROUND:"#ffffff",TEXT:"#000000",FALLBACK:"#ffffff"};let resultsSortAscending=!0,isVerticalMode=!1,lastInputList=[],itemContainerAddBgColor=null,itemContainerAddTextColor=null;const BASE_PRIZE_RESULTS="basePrizeResults";function savePrizeHistory(e){localStorage.setItem(BASE_PRIZE_RESULTS,e)}function loadPrizeHistory(){const e=localStorage.getItem(BASE_PRIZE_RESULTS);e&&(prizeResultElement.value=e)}loadPrizeHistory();const baseColorCycle=["#92c48d","#bddb69","#c386f0","#e67c92"];function getNextColor(e){const t=baseColorCycle.indexOf(e);return t>=0?baseColorCycle[(t+1)%baseColorCycle.length]:baseColorCycle[0]}function syncInputToWheel(){let e=[];const t=WheelPresetManager.getActive(),o=prizeInputElement.value.split("\n").map(e=>e.trim()).filter(Boolean);if(Math.abs(o.length-lastInputList.length)>1){let r=null;for(let n=0;n<o.length;n++){const l=e[n-1]||t.prizes[n-1],i=getNextColor(l?.bgColor||r);e.push({id:crypto.randomUUID(),text:o[n],bgColor:i,textColor:"#ffffff"}),r=i}}else{e=[...t.prizes];let r=-1;const n=Math.max(lastInputList.length,o.length);for(let e=0;e<n;e++)if(lastInputList[e]!==o[e]){r=e;break}if(-1!==r)if(o.length>lastInputList.length){const t=e[r-1],n=getNextColor(t?.bgColor);e.splice(r,0,{id:crypto.randomUUID(),text:o[r],bgColor:n,textColor:"#ffffff"})}else o.length<lastInputList.length?e.splice(r,1):e[r].text=o[r];o.forEach((t,o)=>{e[o]&&(e[o].text=t)}),e.length>o.length&&(e=e.slice(0,o.length))}lastInputList=o,WheelPresetManager.update(t.id,{prizes:e,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(e),syncItemContainerToPrizeInput()}function loadPrizeInputs(){const e=WheelPresetManager.getActive();e&&Array.isArray(e.prizes)?prizeInputElement.value=e.prizes.map(e=>e.text).join("\n"):"en"===LANG?console.warn("⚠️ The current preset has no valid prizes"):"zh"===LANG?console.warn("⚠️ 当前预设没有有效的奖品"):"es"===LANG&&console.warn("⚠️ El preajuste actual no tiene premios válidos")}function entriesShuffleSwitchClick(){const e=WheelPresetManager.getActiveId(),t=WheelPresetManager.get(e);if(!t||!Array.isArray(t.prizes)||0===t.prizes.length){const e=document.querySelector(".wheel-panel-entries-inputs-text-box");return e.classList.add("shake"),void setTimeout(()=>{e.classList.remove("shake")},300)}if(!t||!Array.isArray(t.prizes))return;const o=[...t.prizes];for(let e=o.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[o[e],o[t]]=[o[t],o[e]]}const r=o.map(e=>e.text);prizeInputElement.value=r.join("\n"),lastInputList=[...r],WheelPresetManager.update(e,{prizes:o,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(o),syncItemContainerToPrizeInput()}function naturalSort(e,t){const o=parseFloat(e),r=parseFloat(t),n=!isNaN(o),l=!isNaN(r);return n&&l?o-r:e.localeCompare(t)}function entriesSortSwitchClick(){const e=WheelPresetManager.getActiveId(),t=WheelPresetManager.get(e);if(!t||!Array.isArray(t.prizes)||0===t.prizes.length){const e=document.querySelector(".wheel-panel-entries-inputs-text-box");return e.classList.add("shake"),void setTimeout(()=>{e.classList.remove("shake")},300)}const o=[...t.prizes].sort((e,t)=>{const o=e.text||"",r=t.text||"";return resultsSortAscending?naturalSort(o,r):naturalSort(r,o)}),r=o.map(e=>e.text||"");prizeInputElement.value=r.join("\n"),lastInputList=[...r],WheelPresetManager.update(e,{prizes:o,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(o),resultsSortAscending=!resultsSortAscending,syncItemContainerToPrizeInput()}function resultsShuffleSwitchClick(){const e=prizeResultElement.value.split("\n").map(e=>e.trim()).filter(Boolean);if(0===e.length){const e=document.querySelector(".wheel-panel-results-inputs-text-box");return e.classList.add("shake"),void setTimeout(()=>{e.classList.remove("shake")},300)}for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}prizeResultElement.value=e.join("\n"),savePrizeHistory(prizeResultElement.value)}function resultsClearSwitchClick(){prizeResultElement.value="",localStorage.removeItem(BASE_PRIZE_RESULTS)}function switchToChangeMode(){isVerticalMode=!isVerticalMode;const e=WheelPresetManager.getActive();e.prizes.forEach(e=>{e&&(e.format=e.format||{},isVerticalMode?(e.format.lengthLimit=1,e.format.lineClamp=10):(delete e.format.lengthLimit,delete e.format.lineClamp))}),WheelPresetManager.update(e.id,{prizes:e.prizes,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(e.prizes)}function generateUniqueItemId(){return crypto.randomUUID()}function rgbToHex(e){const t=e.match(/\d+/g);return t&&3===t.length?"#"+t.map(e=>{const t=parseInt(e).toString(16);return 1===t.length?"0"+t:t}).join(""):"#ffffff"}function initializeExistingColorPickers(){document.querySelectorAll("[data-jscolor]").forEach(e=>{const t=e.dataset.key||"default-color";if(!e.jscolor){const o=e.style.backgroundColor||BASE_JSCOLOR_DEFAULT_COLORS.FALLBACK;new jscolor(e,{value:o||void 0,onInput:function(){let e=this.toString();"function"==typeof this.toHEXString&&(e=this.toHEXString());const o=e.startsWith("rgb")?rgbToHex(e):e.startsWith("#")?e:"#"+e;"add-background-color"===t?itemContainerAddBgColor=o:"add-color-color"===t&&(itemContainerAddTextColor=o)}})}})}function initializeItemBoxColorPickers(e){e.querySelectorAll("[data-jscolor]").forEach(e=>{const t=e.dataset.key||"default-color",o=e.style.backgroundColor||BASE_JSCOLOR_DEFAULT_COLORS.FALLBACK;e.jscolor||new jscolor(e,{value:o,onInput:function(){let o=this.toString();"function"==typeof this.toHEXString&&(o=this.toHEXString());const r=o.startsWith("rgb")?rgbToHex(o):o.startsWith("#")?o:"#"+o,n=e.closest(".wheel-panel-entries-advanced-text-item-box"),l=Array.from(itemContainerElement.children).indexOf(n),i=n.querySelector("input")?.value||"",a=WheelPresetManager.getActiveId(),s=WheelPresetManager.get(a);if(s&&l>=0&&s.prizes[l]){const e=[...s.prizes];t.endsWith("-bg")?e[l].bgColor=r:t.endsWith("-color")&&(e[l].textColor=r),e[l].text=i,prizeInputElement.value=e.map(e=>e.text).join("\n"),lastInputList=e.map(e=>e.text),WheelPresetManager.update(a,{prizes:e,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(e)}}})})}function createNewItemBox({id:e,input:t="",bgColor:o=BASE_JSCOLOR_DEFAULT_COLORS.BACKGROUND,textColor:r=BASE_JSCOLOR_DEFAULT_COLORS.TEXT}={}){const n=e||generateUniqueItemId(),l=document.createElement("div");l.className="wheel-panel-entries-advanced-text-item-box",l.dataset.id=n,l.innerHTML=`\n        <div class="wheel-panel-entries-advanced-text-item-input-box">\n            <input placeholder="..." value="${t}" />\n        </div>\n        <div class="wheel-panel-entries-advanced-text-item-background-color-box">\n            <div data-jscolor="" data-key="${n}-bg" class="wheel-panel-entries-advanced-text-item-background-color-inner-box" style="background-color: ${o};"></div>\n        </div>\n        <div class="wheel-panel-entries-advanced-text-item-color-box">\n            <div data-jscolor="" data-key="${n}-color" class="wheel-panel-entries-advanced-text-item-color-inner-box" style="background-color: ${r};"></div>\n        </div>\n        <div class="wheel-panel-entries-advanced-text-add-item-box">\n            <div class="wheel-panel-entries-advanced-text-item-add-inner-box">-</div>\n        </div>\n    `,itemContainerElement.appendChild(l);const i=l.querySelector("input");i.addEventListener("input",()=>{const e=i.value.trim(),t=Array.from(itemContainerElement.children).indexOf(l),o=WheelPresetManager.getActiveId(),r=WheelPresetManager.get(o);if(r&&t>=0&&r.prizes[t]){const n=[...r.prizes];n[t]={...n[t],text:e},prizeInputElement.value=n.map(e=>e.text).join("\n"),lastInputList=n.map(e=>e.text),WheelPresetManager.update(o,{prizes:n,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(n)}}),initializeItemBoxColorPickers(l),l.querySelector(".wheel-panel-entries-advanced-text-item-add-inner-box").addEventListener("click",()=>{deleteItemBox(l,n)})}function deleteItemBox(e,t){const o=Array.from(itemContainerElement.children).indexOf(e);if(-1===o)return;itemContainerElement.removeChild(e);const r=WheelPresetManager.getActiveId(),n=WheelPresetManager.get(r);if(!n)return;const l=[...n.prizes].filter((e,r)=>r!==o&&e.id!==t),i=l.map(e=>e.text);prizeInputElement.value=i.join("\n"),lastInputList=[...i],WheelPresetManager.update(r,{prizes:l,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(l)}function addItemButton(){const e=document.querySelector(".wheel-panel-entries-advanced-text-add-input-box input"),t=e.value.trim();if(!t){const e=document.querySelector(".wheel-panel-entries-advanced-text-add-input-box");return e.classList.add("shake"),void setTimeout(()=>{e.classList.remove("shake")},300)}const o=WheelPresetManager.getActiveId(),r=WheelPresetManager.get(o);if(!r)return;const n=[...r.prizes],l=n[n.length-1],i=itemContainerAddBgColor&&"#ffffff"!==itemContainerAddBgColor?itemContainerAddBgColor:getNextColor(l?.bgColor||"#ffffff"),a=itemContainerAddTextColor&&"#ffffff"!==itemContainerAddTextColor?itemContainerAddTextColor:"#ffffff",s={id:crypto.randomUUID(),text:t,bgColor:i,textColor:a};n.push(s),prizeInputElement.value=n.map(e=>e.text).join("\n"),lastInputList=n.map(e=>e.text),WheelPresetManager.update(o,{prizes:n,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(n),createNewItemBox({input:t,bgColor:i,textColor:a}),e.value=""}function addItemPresetButton(){const e=document.querySelector(".wheel-preset-text-add-input-box input"),t=e.value.trim();if(!t){const e=document.querySelector(".wheel-preset-text-add-input-box");return e.classList.add("shake"),void setTimeout(()=>{e.classList.remove("shake")},300)}if(WheelPresetManager.getAll().some(e=>e.name===t))return void("en"===LANG?alert(`A preset named "${t}" already exists`):"zh"===LANG?alert(`名为 “${t}” 的预设已存在`):"es"===LANG&&alert(`Ya tienes un preajuste llamado "${t}"`));const o={id:crypto.randomUUID(),name:t,isDefault:!1,prizes:[]};WheelPresetManager.add(o),e.value="",renderPresetItems()}function renderPresetItems(){const e=WheelPresetManager.getAll(),t=document.querySelector(".wheel-preset-text-overflow-box");t.innerHTML="",e.forEach(o=>{const r=document.createElement("div");r.className="wheel-preset-text-item-box",r.dataset.id=o.id,r.innerHTML=`\n            <div class="wheel-preset-text-item-input-box">\n                <input value="${o.name}" placeholder="..." readonly/>\n            </div>\n            <div class="wheel-preset-text-add-item-box">\n                <div class="wheel-preset-text-item-add-inner-box">-</div>\n            </div>\n        `,o.isDefault&&r.classList.add("default-preset"),r.querySelector(".wheel-preset-text-item-input-box").addEventListener("click",()=>{e.forEach(e=>e.isDefault=e.id===o.id),e.forEach(e=>{WheelPresetManager.update(e.id,{isDefault:e.isDefault})}),WheelPresetManager.apply(o.id),document.querySelectorAll(".wheel-preset-text-item-box").forEach(e=>e.classList.remove("default-preset")),r.classList.add("default-preset");const t=WheelPresetManager.getActive();prizeInputElement.value=t.prizes.map(e=>e.text).join("\n"),WheelPresetManager.update(t.id,{prizes:t.prizes,lastUsedAt:Date.now()}),myWheel.prizes=transformPresetPrizesToLuckyWheel(t.prizes),syncItemContainerToPrizeInput()}),r.querySelector(".wheel-preset-text-item-add-inner-box").addEventListener("click",()=>{if(o.isDefault)"en"===LANG?alert("The selected preset cannot be deleted"):"zh"===LANG?alert("所选预设无法删除"):"es"===LANG&&alert("El preajuste seleccionado no se puede eliminar");else{if("en"===LANG){if(!confirm(`Are you sure you want to delete the preset "${o.name}"?`))return}else if("zh"===LANG){if(!confirm(`您确定要删除预设 “${o.name}” 吗？`))return}else if("es"===LANG&&!confirm(`¿Estás seguro de que quieres eliminar el preajuste "${o.name}"?`))return;WheelPresetManager.remove(o.id),renderPresetItems()}}),t.appendChild(r)})}function syncItemContainerToPrizeInput(){if(!itemContainerElement)return;itemContainerElement.innerHTML="";const e=WheelPresetManager.getActive();e&&Array.isArray(e.prizes)&&e.prizes.forEach((e,t)=>{createNewItemBox({id:e.id||`preset-${Date.now()}-${t}`,input:e.text||"",bgColor:e.bgColor||"#ffffff",textColor:e.textColor||"#000000"})})}function setSwitchToActiveMode(e){const t=document.querySelector(".wheel-panel-operate-entries-box"),o=document.querySelector(".wheel-panel-operate-results-box"),r=document.querySelector(".wheel-panel-entries-box"),n=document.querySelector(".wheel-panel-results-box");t.classList.remove("wheel-panel-operate-entries-and-results-box-active"),o.classList.remove("wheel-panel-operate-entries-and-results-box-active"),"entries"===e?(t.classList.add("wheel-panel-operate-entries-and-results-box-active"),r.style.display="block",n.style.display="none"):(o.classList.add("wheel-panel-operate-entries-and-results-box-active"),r.style.display="none",n.style.display="block"),WheelPresetManager.update(WheelPresetManager.getActiveId(),{mode:e})}function setSwitchToAdvancedActiveMode(e){const t=document.querySelector(".wheel-panel-entries-operate-advanced-box"),o=document.querySelector(".wheel-panel-entries-inputs-box"),r=document.querySelector(".wheel-panel-entries-advanced-box");t.classList.remove("wheel-panel-entries-operate-advanced-box-active"),"open"===e?(t.classList.add("wheel-panel-entries-operate-advanced-box-active"),o.style.display="none",r.style.display="flex",document.querySelector(".wheel-panel-entries-operate-shuffle-box")?.classList.add("disabled"),document.querySelector(".wheel-panel-entries-operate-sort-box")?.classList.add("disabled")):(o.style.display="flex",r.style.display="none",document.querySelector(".wheel-panel-entries-operate-shuffle-box")?.classList.remove("disabled"),document.querySelector(".wheel-panel-entries-operate-sort-box")?.classList.remove("disabled")),WheelPresetManager.update(WheelPresetManager.getActiveId(),{advancedMode:e})}loadPrizeInputs(),initializeExistingColorPickers(),renderPresetItems(),syncItemContainerToPrizeInput();let originalWheelWidth,originalWheelHeight,isExpand=!1;const styleMyWheelBoxEl=document.querySelector(".my-wheel-box");function theExpandMode(){wheelScopeCenterBoxElement.classList.remove("wheel-scope-center-box-shake"),isExpand=!0,originalWheelWidth=myWheel.width,originalWheelHeight=myWheel.height,styleMyWheelBoxEl.classList.add("my-wheel-box-expand");const e=.88*Math.min(window.innerWidth,window.innerHeight)+"px";MY_WHEEL_WIDTH=e,MY_WHEEL_HEIGHT=e,myWheel.width=MY_WHEEL_WIDTH,myWheel.height=MY_WHEEL_HEIGHT}function switchToEntriesMode(){setSwitchToActiveMode("entries")}function switchToResultsMode(){setSwitchToActiveMode("results")}function switchToAdvancedMode(){setSwitchToAdvancedActiveMode("open"===(WheelPresetManager.getActive().advancedMode||"close")?"close":"open")}document.addEventListener("click",function(e){const t=document.getElementById("my-wheel"),o=document.querySelector(".wheel-scope-center-box"),r=document.getElementById("luckySuccessModal");!isExpand||t.contains(e.target)||o.contains(e.target)||r.contains(e.target)||(styleMyWheelBoxEl.classList.remove("my-wheel-box-expand"),myWheel.width=originalWheelWidth,myWheel.height=originalWheelHeight)});let luckyModalTimeoutId=null;function showLuckyModal(e="Unknown"){const t=document.getElementById("luckySuccessModal");document.getElementById("luckyPrizeText").textContent=e,t.classList.remove("hidden"),luckyModalTimeoutId&&clearTimeout(luckyModalTimeoutId),luckyModalTimeoutId=setTimeout(()=>{t.classList.add("hidden"),luckyModalTimeoutId=null},1e4)}function closeLuckyModal(){document.getElementById("luckySuccessModal").classList.add("hidden")}const wheelPanelOperatePresetBoxEl=document.querySelector(".wheel-panel-operate-preset-box"),wheelPresetBoxEl=wheelPanelOperatePresetBoxEl.querySelector(".wheel-preset-box");let hideTimer;wheelPanelOperatePresetBoxEl.addEventListener("mouseenter",()=>{clearTimeout(hideTimer),wheelPresetBoxEl.style.display="flex"}),wheelPanelOperatePresetBoxEl.addEventListener("mouseleave",()=>{hideTimer=setTimeout(()=>{wheelPresetBoxEl.style.display="none"},200)}),window.addEventListener("DOMContentLoaded",()=>{const e=WheelPresetManager.getActive(),t=e?.mode||"entries",o=e?.advancedMode||"close";setSwitchToActiveMode(t),setSwitchToAdvancedActiveMode(o)}),prizeInputElement.addEventListener("input",syncInputToWheel),itemContainerAddSelector.addEventListener("click",addItemButton),itemPresetContainerAddSelector.addEventListener("click",addItemPresetButton);const luckyBox=document.querySelector(".my-wheel-box");function updateWheelSize(){const e=luckyBox?.offsetWidth||330;myWheel.width=e,myWheel.height=e}function debounce(e,t){let o;return function(...r){clearTimeout(o),o=setTimeout(()=>e.apply(this,r),t)}}const debouncedUpdateWheelSize=debounce(updateWheelSize,200);window.addEventListener("resize",debouncedUpdateWheelSize),updateWheelSize();